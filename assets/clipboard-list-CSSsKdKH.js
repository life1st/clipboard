import{u as s,a as e,b as a,c as i,j as t,M as n,B as l,S as c,d as r,e as o,f as d,D as h,g as m}from"./index-JISBR4xu.js";import{r as x,L as j}from"./vendor-BpSuX29s.js";import{c as p}from"./index-uetpjLjy.js";import"./api-C-1G2k3o.js";import"./store-PA_90aFs.js";const u=()=>{const{isOpen:c,content:r,closeModal:o,setContent:d}=s(),{addItem:h}=e(),{gistId:m,githubToken:j}=a(),{showSuccess:p,showError:u}=i(),g=x.useMemo(()=>!(!m||!j),[m,j]);return t.jsxs(n,{isOpen:c,onClose:o,title:"添加剪贴板项目",className:"paste-modal",children:[t.jsxs("div",{className:"input-group",children:[t.jsx("label",{children:"内容:"}),t.jsx("textarea",{value:r,onChange:s=>d(s.target.value),placeholder:"粘贴或输入内容",rows:6})]}),g&&t.jsxs("div",{className:"input-group",children:[t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:!0,disabled:!0}),"自动同步到 Gist (clipboard.json)"]}),t.jsx("small",{className:"help-text",children:"项目添加后将自动更新到 Gist 中的 clipboard.json 文件"})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx(l,{variant:"primary",onClick:async()=>{if(r.trim())try{await h(r.trim()),p(g?"项目已添加并同步到 Gist":"项目已添加到本地"),o()}catch(s){u(g?`项目已添加到本地，但 Gist 同步失败: ${s.message}`:`添加失败: ${s.message}`)}},disabled:!r.trim(),fullWidth:!0,children:"添加"}),t.jsx(l,{variant:"ghost",onClick:o,fullWidth:!0,children:"取消"})]})]})},g=({item:s,onDelete:e})=>{const{showError:a}=i(),[n,l]=x.useState(!1),c=x.useCallback(m(()=>l(!1),2e3),[]);return t.jsxs("div",{className:"clipboard-item",onClick:()=>(async s=>{try{await navigator.clipboard.writeText(s),l(!0),c()}catch(e){a("复制失败，请检查浏览器权限")}})(s.content),children:[t.jsxs("div",{className:"item-content",children:[t.jsx("div",{className:"content-text",children:s.content.length>100?s.content.substring(0,100)+"...":s.content}),t.jsxs("div",{className:"item-meta",children:[t.jsx("span",{className:"timestamp",children:new Date(s.timestamp).toLocaleString()}),t.jsx("span",{className:p("copy-status",{copied:n}),children:n?"✅已复制":"点击复制"})]})]}),t.jsx("button",{type:"button",onClick:async i=>{i.stopPropagation();try{await e(s.id)}catch(t){a(`删除失败: ${t.message}`)}},onMouseDown:s=>s.stopPropagation(),onFocus:s=>s.stopPropagation(),title:"删除",className:"delete-button",children:"✕"})]})},v=()=>{const{items:n,loading:m,error:p,lastSync:v,maxItems:N,sortBy:b,sortOrder:y,deleteItem:C,clearAll:T,setError:f,setMaxItems:M,setSortBy:S,setSortOrder:k,loadFromGist:I}=e(),{showError:w}=i(),G=x.useMemo(()=>n.length,[n]),E=x.useMemo(()=>n.length>0,[n]),{gistId:D,githubToken:A}=a(),{openModal:O}=s(),[P,$]=x.useState(!0),z=x.useMemo(()=>!(!D||!A),[D,A]);return t.jsx("div",{className:"clipboard-list-page",children:t.jsxs("div",{className:"page-content",children:[!z&&t.jsx("div",{className:"config-prompt-section",children:t.jsxs("div",{className:"config-prompt",children:[t.jsx("div",{className:"prompt-icon",children:"⚙️"}),t.jsxs("div",{className:"prompt-content",children:[t.jsx("h3",{children:"需要配置 Gist 同步"}),t.jsx("p",{children:"要使用 Gist 同步功能，请先在设置页面配置 GitHub Token 和 Gist ID"}),t.jsx(j,{to:"/settings",children:t.jsx(l,{variant:"primary",fullWidth:!0,children:"🚀 前往设置页面"})})]})]})}),z&&t.jsxs("div",{className:"gist-sync-section",children:[t.jsxs("div",{className:"gist-sync-header",children:[t.jsx("h3",{children:"Gist 同步"}),t.jsx(l,{variant:"secondary",onClick:async()=>{z?I():f("请先在设置页面配置 Gist ID 和 Token")},disabled:m||!z,loading:m,fullWidth:!0,title:"保存当前数据到 Gist",size:"sm",className:"gist-sync-button",children:m?"同步中...":"从 Gist 同步"})]}),t.jsxs("div",{className:"sync-info",children:[t.jsxs("span",{children:["Gist ID: ",D?"✅":"❌"]}),t.jsxs("span",{children:["Token: ",A?"✅":"❌"]})]}),t.jsx("div",{className:"sync-controls",children:t.jsxs("div",{className:"auto-load-info",children:[t.jsx("span",{className:"info-text",children:E?`已加载 ${G} 个项目`:"暂无数据，将自动从 Gist 加载"}),v&&t.jsxs("span",{className:"last-sync",children:["最后同步: ",new Date(v).toLocaleString()]})]})})]}),t.jsxs("div",{className:"settings-section",children:[t.jsxs("div",{className:"settings-header",children:[t.jsx("h3",{children:"显示设置"}),t.jsx(l,{variant:"ghost",size:"sm",onClick:()=>$(!P),title:P?"展开显示设置":"折叠显示设置",children:P?"▶️":"▼️"})]}),!P&&t.jsxs("div",{className:"display-options",children:[t.jsxs("div",{className:"input-group",children:[t.jsx("label",{children:"排序方式:"}),t.jsxs("select",{value:b,onChange:s=>S(s.target.value),children:[t.jsx("option",{value:r.TIMESTAMP,children:c[r.TIMESTAMP]}),t.jsx("option",{value:r.CONTENT,children:c[r.CONTENT]})]})]}),t.jsxs("div",{className:"input-group",children:[t.jsx("label",{children:"排序顺序:"}),t.jsxs("select",{value:y,onChange:s=>k(s.target.value),children:[t.jsx("option",{value:d.DESC,children:o[d.DESC]}),t.jsx("option",{value:d.ASC,children:o[d.ASC]})]})]}),t.jsxs("div",{className:"input-group",children:[t.jsx("label",{children:"最大显示项目数:"}),t.jsx("input",{type:"number",value:N,onChange:s=>M(parseInt(s.target.value)||h.DEFAULT_ITEMS),min:h.MIN_ITEMS,max:h.MAX_ITEMS})]})]})]}),p&&t.jsx("div",{className:"error-message",children:p}),t.jsxs("div",{className:"clipboard-section",children:[t.jsxs("div",{className:"section-header",children:[t.jsxs("h3",{children:["剪贴板项目 (",G,")"]}),t.jsx("div",{className:"header-actions",children:t.jsx(l,{variant:"danger",onClick:async()=>{if(window.confirm("确定要清空所有项目吗？"))try{await T()}catch(s){w(`清空失败: ${s.message}`)}},disabled:!E,size:"sm",children:"清空所有"})})]}),0===n.length?t.jsxs("div",{className:"empty-state",children:[t.jsx("p",{children:"暂无剪贴板项目"}),t.jsx("p",{children:"点击右下角的粘贴按钮来添加内容"})]}):t.jsx("div",{className:"clipboard-list",children:n.map(s=>t.jsx(g,{item:s,onDelete:C},s.id))})]}),t.jsx(l,{variant:"primary",size:"lg",onClick:()=>{navigator.clipboard.readText().then(s=>{O(s)}).catch(s=>{f("读取剪贴板失败，请检查浏览器权限")})},title:"从剪贴板粘贴",className:"floating-paste-button",children:"Paste"}),t.jsx(u,{})]})})};export{v as default};
